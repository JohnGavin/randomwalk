[{"name":"app.R","content":"# Mount WebAssembly file system from same-origin (avoids CORS issues)\n# The pkgdown workflow downloads library.data from releases to docs/wasm/\n# This allows the dashboard to load it from the same domain (johngavin.github.io)\nwebr::mount(\n  mountpoint = \"/randomwalk-lib\",\n  source = \"/randomwalk/wasm/library.data\"\n)\n\n# Add mounted library to library paths\n.libPaths(c(\"/randomwalk-lib\", .libPaths()))\n\n# Load required packages\nlibrary(shiny)\n\n# Load randomwalk from mounted library\nlibrary(randomwalk)\n\n# UI\nui <- fluidPage(\n  titlePanel(\"Random Walk Simulation Dashboard\"),\n\n  sidebarLayout(\n    sidebarPanel(\n      width = 3,\n      h4(\"Simulation Parameters\"),\n\n      sliderInput(\"grid_size\", \"Grid Size:\",\n                  min = 5, max = 50, value = 20, step = 1),\n\n      sliderInput(\"n_walkers\", \"Number of Walkers:\",\n                  min = 1, max = 20, value = 5, step = 1),\n\n      selectInput(\"neighborhood\", \"Neighborhood Type:\",\n                  choices = c(\"4-hood\" = \"4-hood\", \"8-hood\" = \"8-hood\"),\n                  selected = \"4-hood\"),\n\n      selectInput(\"boundary\", \"Boundary Behavior:\",\n                  choices = c(\"Terminate\" = \"terminate\", \"Wrap\" = \"wrap\"),\n                  selected = \"terminate\"),\n\n      sliderInput(\"max_steps\", \"Max Steps:\",\n                  min = 1000, max = 20000, value = 10000, step = 1000),\n\n      hr(),\n\n      actionButton(\"run_sim\", \"Run Simulation\",\n                   class = \"btn-primary\", width = \"100%\"),\n\n      actionButton(\"reset\", \"Reset Parameters\",\n                   class = \"btn-secondary\", width = \"100%\",\n                   style = \"margin-top: 10px;\")\n    ),\n\n    mainPanel(\n      width = 9,\n\n      tabsetPanel(\n        id = \"output_tabs\",\n\n        tabPanel(\"Grid State\",\n                 br(),\n                 plotOutput(\"grid_plot\", height = \"600px\")),\n\n        tabPanel(\"Walker Paths\",\n                 br(),\n                 plotOutput(\"paths_plot\", height = \"600px\")),\n\n        tabPanel(\"Statistics\",\n                 br(),\n                 h4(\"Simulation Statistics\"),\n                 verbatimTextOutput(\"stats_text\"),\n                 hr(),\n                 h4(\"Parameters Used\"),\n                 tableOutput(\"params_table\")),\n\n        tabPanel(\"Raw Data\",\n                 br(),\n                 h4(\"Walker Data\"),\n                 tableOutput(\"walker_table\"),\n                 hr(),\n                 h4(\"Grid Information\"),\n                 verbatimTextOutput(\"grid_info\"))\n      )\n    )\n  )\n)\n\n# Server\nserver <- function(input, output, session) {\n\n  # Update max walkers based on grid size\n  observe({\n    max_walkers <- floor(input$grid_size * input$grid_size * 0.3)\n    updateSliderInput(session, \"n_walkers\",\n                     max = max_walkers,\n                     value = min(input$n_walkers, max_walkers))\n  })\n\n  # Reset button\n  observeEvent(input$reset, {\n    updateSliderInput(session, \"grid_size\", value = 20)\n    updateSliderInput(session, \"n_walkers\", value = 5)\n    updateSelectInput(session, \"neighborhood\", selected = \"4-hood\")\n    updateSelectInput(session, \"boundary\", selected = \"terminate\")\n    updateSliderInput(session, \"max_steps\", value = 10000)\n  })\n\n  # Run simulation using package function\n  sim_result <- eventReactive(input$run_sim, {\n    withProgress(message = 'Running simulation...', {\n      result <- randomwalk::run_simulation(\n        grid_size = input$grid_size,\n        n_walkers = input$n_walkers,\n        neighborhood = input$neighborhood,\n        boundary = input$boundary,\n        max_steps = input$max_steps\n      )\n      result\n    })\n  })\n\n  # Grid plot using package function\n  output$grid_plot <- renderPlot({\n    req(sim_result())\n    randomwalk::plot_grid(sim_result())\n  })\n\n  # Paths plot using package function\n  output$paths_plot <- renderPlot({\n    req(sim_result())\n    randomwalk::plot_walker_paths(sim_result())\n  })\n\n  # Statistics\n  output$stats_text <- renderText({\n    req(sim_result())\n    stats <- sim_result()$statistics\n    paste(\n      sprintf(\"Black Pixels: %d (%.2f%%)\",\n              stats$black_pixels, stats$black_percentage),\n      sprintf(\"Total Walkers: %d\", stats$total_walkers),\n      sprintf(\"Completed Walkers: %d\", stats$completed_walkers),\n      sprintf(\"Total Steps: %d\", stats$total_steps),\n      sep = \"\\n\"\n    )\n  })\n\n  # Parameters table\n  output$params_table <- renderTable({\n    req(sim_result())\n    result <- sim_result()\n    data.frame(\n      Parameter = c(\"Grid Size\", \"Walkers\", \"Neighborhood\", \"Boundary\", \"Max Steps\"),\n      Value = c(\n        result$grid_size,\n        result$n_walkers,\n        result$neighborhood,\n        result$boundary,\n        input$max_steps\n      )\n    )\n  })\n\n  # Walker table\n  output$walker_table <- renderTable({\n    req(sim_result())\n    result <- sim_result()\n\n    walker_data <- data.frame(\n      Walker = seq_along(result$walker_paths),\n      Steps = sapply(result$walker_paths, function(p) nrow(p)),\n      Final_X = sapply(result$walker_paths, function(p) p[nrow(p), 1]),\n      Final_Y = sapply(result$walker_paths, function(p) p[nrow(p), 2])\n    )\n    walker_data\n  })\n\n  # Grid info\n  output$grid_info <- renderText({\n    req(sim_result())\n    result <- sim_result()\n    stats <- result$statistics\n\n    paste(\n      sprintf(\"Grid dimensions: %d x %d\", result$grid_size, result$grid_size),\n      sprintf(\"Total pixels: %d\", result$grid_size * result$grid_size),\n      sprintf(\"Black pixels: %d (%.2f%%)\",\n              stats$black_pixels, stats$black_percentage),\n      sprintf(\"White pixels: %d\",\n              result$grid_size * result$grid_size - stats$black_pixels),\n      sep = \"\\n\"\n    )\n  })\n}\n\nshinyApp(ui = ui, server = server)\n","type":"text"}]
