---
title: "Interactive Dashboard"
format: html
filters:
  - shinylive
---

# Random Walk Simulation Dashboard

This vignette provides a **fully interactive Shiny application** that runs directly in your browser using WebAssembly. No R installation or server required!

## Interactive Dashboard

Use the controls below to configure simulation parameters and visualize results in real-time:

```{shinylive-r}
#| standalone: true
#| viewerHeight: 800

# Install randomwalk package from GitHub with WebAssembly binaries
webr::install("randomwalk", repos = "https://johngavin.r-universe.dev")

library(shiny)
library(randomwalk)

# UI
ui <- fluidPage(
  titlePanel("Random Walk Simulation Dashboard"),

  sidebarLayout(
    sidebarPanel(
      width = 3,
      h4("Simulation Parameters"),

      sliderInput("grid_size", "Grid Size:",
                  min = 5, max = 50, value = 20, step = 1),

      sliderInput("n_walkers", "Number of Walkers:",
                  min = 1, max = 20, value = 5, step = 1),

      selectInput("neighborhood", "Neighborhood Type:",
                  choices = c("4-hood" = "4-hood", "8-hood" = "8-hood"),
                  selected = "4-hood"),

      selectInput("boundary", "Boundary Behavior:",
                  choices = c("Terminate" = "terminate", "Wrap" = "wrap"),
                  selected = "terminate"),

      sliderInput("max_steps", "Max Steps:",
                  min = 1000, max = 20000, value = 10000, step = 1000),

      hr(),

      actionButton("run_sim", "Run Simulation",
                   class = "btn-primary", width = "100%"),

      actionButton("reset", "Reset Parameters",
                   class = "btn-secondary", width = "100%",
                   style = "margin-top: 10px;")
    ),

    mainPanel(
      width = 9,

      tabsetPanel(
        id = "output_tabs",

        tabPanel("Grid State",
                 br(),
                 plotOutput("grid_plot", height = "600px")),

        tabPanel("Walker Paths",
                 br(),
                 plotOutput("paths_plot", height = "600px")),

        tabPanel("Statistics",
                 br(),
                 h4("Simulation Statistics"),
                 verbatimTextOutput("stats_text"),
                 hr(),
                 h4("Parameters Used"),
                 tableOutput("params_table")),

        tabPanel("Raw Data",
                 br(),
                 h4("Walker Data"),
                 tableOutput("walker_table"),
                 hr(),
                 h4("Grid Information"),
                 verbatimTextOutput("grid_info"))
      )
    )
  )
)

# Server
server <- function(input, output, session) {

  # Update max walkers based on grid size
  observe({
    max_walkers <- floor(input$grid_size * input$grid_size * 0.3)
    updateSliderInput(session, "n_walkers",
                     max = max_walkers,
                     value = min(input$n_walkers, max_walkers))
  })

  # Reset button
  observeEvent(input$reset, {
    updateSliderInput(session, "grid_size", value = 20)
    updateSliderInput(session, "n_walkers", value = 5)
    updateSelectInput(session, "neighborhood", selected = "4-hood")
    updateSelectInput(session, "boundary", selected = "terminate")
    updateSliderInput(session, "max_steps", value = 10000)
  })

  # Run simulation using package function
  sim_result <- eventReactive(input$run_sim, {
    withProgress(message = 'Running simulation...', {
      result <- run_simulation(
        grid_size = input$grid_size,
        n_walkers = input$n_walkers,
        neighborhood = input$neighborhood,
        boundary = input$boundary,
        max_steps = input$max_steps
      )
      result
    })
  })

  # Grid plot using package function
  output$grid_plot <- renderPlot({
    req(sim_result())
    plot_grid(sim_result())
  })

  # Paths plot using package function
  output$paths_plot <- renderPlot({
    req(sim_result())
    plot_walker_paths(sim_result())
  })

  # Statistics
  output$stats_text <- renderText({
    req(sim_result())
    stats <- sim_result()$statistics
    paste(
      sprintf("Black Pixels: %d (%.2f%%)",
              stats$black_pixels, stats$black_percentage),
      sprintf("Total Walkers: %d", stats$total_walkers),
      sprintf("Completed Walkers: %d", stats$completed_walkers),
      sprintf("Total Steps: %d", stats$total_steps),
      sep = "\n"
    )
  })

  # Parameters table
  output$params_table <- renderTable({
    req(sim_result())
    result <- sim_result()
    data.frame(
      Parameter = c("Grid Size", "Walkers", "Neighborhood", "Boundary", "Max Steps"),
      Value = c(
        result$grid_size,
        result$n_walkers,
        result$neighborhood,
        result$boundary,
        input$max_steps
      )
    )
  })

  # Walker table
  output$walker_table <- renderTable({
    req(sim_result())
    result <- sim_result()

    walker_data <- data.frame(
      Walker = seq_along(result$walker_paths),
      Steps = sapply(result$walker_paths, function(p) nrow(p)),
      Final_X = sapply(result$walker_paths, function(p) p[nrow(p), 1]),
      Final_Y = sapply(result$walker_paths, function(p) p[nrow(p), 2])
    )
    walker_data
  })

  # Grid info
  output$grid_info <- renderText({
    req(sim_result())
    result <- sim_result()
    stats <- result$statistics

    paste(
      sprintf("Grid dimensions: %d x %d", result$grid_size, result$grid_size),
      sprintf("Total pixels: %d", result$grid_size * result$grid_size),
      sprintf("Black pixels: %d (%.2f%%)",
              stats$black_pixels, stats$black_percentage),
      sprintf("White pixels: %d",
              result$grid_size * result$grid_size - stats$black_pixels),
      sep = "\n"
    )
  })
}

shinyApp(ui = ui, server = server)
```

## How to Use

1. **Adjust Parameters** in the left sidebar
2. **Click "Run Simulation"** to execute
3. **Explore Results** across four tabs:
   - **Grid State**: Final black pixel pattern
   - **Walker Paths**: Individual walker trajectories
   - **Statistics**: Quantitative metrics
   - **Raw Data**: Detailed walker and grid information

## Features

- **Runs entirely in your browser** - No R installation needed
- **Uses actual package functions** - No code duplication
- **Interactive controls** - Sliders, dropdowns, and buttons
- **Real-time visualization** - See results immediately
- **Multiple output views** - Four tabs with different perspectives
- **WebAssembly powered** - Fast performance using shinylive

## Technical Details

This dashboard uses [Shinylive](https://posit-dev.github.io/r-shinylive/) to run R and Shiny entirely in your web browser using WebAssembly. The randomwalk package is installed from GitHub with WebAssembly binaries built automatically on each release.

### Package Functions Used

- `run_simulation()` - Core simulation engine
- `plot_grid()` - Visualizes final grid state
- `plot_walker_paths()` - Shows walker trajectories with start/end markers

### Installation for Local Use

To run the full-featured version locally with additional capabilities:

```r
# Install from GitHub
# install.packages("pak")
pak::pak("JohnGavin/randomwalk")

# Or use remotes
# install.packages("remotes")
remotes::install_github("JohnGavin/randomwalk")

# Launch the dashboard
library(randomwalk)
run_dashboard()
```

The local version includes:
- Parallel processing with multiple workers
- Database integration for large-scale simulations
- targets pipeline integration
- Extended parameter ranges
